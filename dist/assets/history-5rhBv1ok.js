import{_ as M,a as T}from"./round-search-tzxKjPJ8.js";import{d as S,r as c,bv as $,a as z,F as B,ab as F,b as U,f as o,w as r,g as n,c7 as P,cc as j,B as w,h as b,b_ as x,e as h,c3 as V,be as J,o as K}from"./index-Fa26LLGJ.js";import{a as D}from"./department-manage-B2EuzGA4.js";import{_ as L}from"./FormItem-BZKeQ143.js";import{_ as G,a as d}from"./Grid-B2FtaVgP.js";import{N as I}from"./Input-CaFfWc_O.js";import{_ as O}from"./DatePicker-rMn-1Kn0.js";import{_ as q}from"./Space-DmpO1c5Z.js";import{_ as H,a as Q}from"./DataTable-rjo85Lnz.js";import{_ as W}from"./InputNumber-CPlT6_RR.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./get-D-rsvxxO.js";import"./get-slot-Bk_rJcZu.js";import"./use-locale-3ZZNx-H2.js";import"./use-keyboard-DyVeZvMZ.js";import"./FocusDetector-UVToc5yR.js";import"./Follower-YbKMuAEO.js";import"./Forward-Cjyugl_j.js";import"./Dropdown-CxFzKVN2.js";import"./Popover-OLpDKtti.js";import"./use-compitable-BSzTa9o4.js";import"./create-C8zW23Rr.js";import"./Tooltip-DtJC1sbC.js";import"./Select-Bmi32fUm.js";import"./download-C2161hUv.js";const Z={class:"user-management"},ee={class:"flex items-center gap-4 mt-4"},te={class:"flex items-center gap-2"},ae=S({__name:"history",setup(oe){J();const s=c({Employee_ID:"",Dept_Number:"",Date:null}),m=c([]),e=$({Page_Number:1,Row_Count:10,"item-count":0}),g=c(!1),i=c(1),y=z(()=>{const a=e["item-count"];return a===0?1:Math.ceil(a/e.Row_Count)}),k=[{title:"Employee ID",key:"emp_no",width:120},{title:"Dept ID",key:"dept_no",width:120},{title:"From Date",key:"from_date",width:140},{title:"To Date",key:"to_date",width:140}];function A(){console.log("Search conditions:",s),e.Page_Number=1,p()}function E(){C(),p()}function R(){const a=i.value;if(!a||a<1){window.$message?.warning("Please enter a valid page number"),i.value=e.Page_Number;return}const t=y.value;if(a>t){window.$message?.warning(`Page number cannot exceed ${t}`),i.value=e.Page_Number;return}e.Page_Number=a}function C(){s.value={Employee_ID:"",Dept_Number:"",Date:null}}function p(){g.value=!0;let a={...s.value,Page_Number:e.Page_Number||1,Row_Count:e.Row_Count||10};if(a.Date){const[t,u]=a.Date;a.From_Date=t?P(t).format("YYYY-MM-DD"):void 0,a.To_Date=u?P(u).format("YYYY-MM-DD"):void 0,delete a.Date}a=j(a),D(a).then(t=>{Array.isArray(t)?(m.value=t,t.length<e.Row_Count?e["item-count"]=(e.Page_Number-1)*e.Row_Count+t.length:(N(a).then(u=>{u!==null?e["item-count"]=u:e["item-count"]=e.Page_Number*e.Row_Count+1}),e["item-count"]=e.Page_Number*e.Row_Count+1)):t&&t.data&&Array.isArray(t.data)?(m.value=t.data,t.total!==void 0?e["item-count"]=t.total:t.data.length<e.Row_Count?e["item-count"]=(e.Page_Number-1)*e.Row_Count+t.data.length:(N(a).then(u=>{u!==null?e["item-count"]=u:e["item-count"]=e.Page_Number*e.Row_Count+1}),e["item-count"]=e.Page_Number*e.Row_Count+1)):(m.value=[],e["item-count"]=0)}).catch(t=>{console.error("Search error:",t),window.$message?.error(t?.message||"Failed to fetch manager history"),m.value=[],e["item-count"]=0}).finally(()=>{g.value=!1})}async function N(a){try{const t={...a,Page_Number:10,Row_Count:e.Row_Count},u=await D(t),_=Array.isArray(u)?u:u?.data||[];if(_.length===0){for(let l=9;l>=2;l--){const Y={...a,Page_Number:l,Row_Count:e.Row_Count},f=await D(Y),v=Array.isArray(f)?f:f?.data||[];if(v.length>0)return v.length<e.Row_Count?(l-1)*e.Row_Count+v.length:l*e.Row_Count+1}return e.Row_Count}else return _.length<e.Row_Count?9*e.Row_Count+_.length:10*e.Row_Count}catch(t){return console.error("Error checking total count:",t),null}}return B(()=>{e.Page_Number=1,C(),p()}),F(()=>e.Page_Number,a=>{i.value=a,p()}),(a,t)=>{const u=M,_=T;return K(),U("div",Z,[o(n(x),{title:"Search Conditions",class:"mb-4"},{default:r(()=>[o(n(L),{model:s.value,"label-placement":"left","label-width":"130px",class:"search-form"},{default:r(()=>[o(n(G),{cols:4,"x-gap":16,"y-gap":16},{default:r(()=>[o(n(d),{label:"Employee ID",span:1},{default:r(()=>[o(n(I),{value:s.value.Employee_ID,"onUpdate:value":t[0]||(t[0]=l=>s.value.Employee_ID=l),clearable:"",placeholder:"Please Input"},null,8,["value"])]),_:1}),o(n(d),{label:"Dept ID",span:1},{default:r(()=>[o(n(I),{value:s.value.Dept_Number,"onUpdate:value":t[1]||(t[1]=l=>s.value.Dept_Number=l),clearable:"",placeholder:"Please Input"},null,8,["value"])]),_:1}),o(n(d),{label:"Date Range",span:1},{default:r(()=>[o(n(O),{value:s.value.Date,"onUpdate:value":t[2]||(t[2]=l=>s.value.Date=l),type:"daterange",clearable:"",placeholder:"Select Date Range",style:{width:"100%"}},null,8,["value"])]),_:1}),o(n(d),{span:1},{default:r(()=>[o(n(q),null,{default:r(()=>[o(n(w),{type:"primary",onClick:A},{icon:r(()=>[o(u)]),default:r(()=>[t[5]||(t[5]=b(" Search ",-1))]),_:1}),o(n(w),{onClick:E},{icon:r(()=>[o(_)]),default:r(()=>[t[6]||(t[6]=b(" Reset ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o(n(x),{title:"All Department Managers (Legacy)"},{default:r(()=>[o(n(H),{columns:k,data:m.value,loading:g.value,bordered:!1,"single-line":!1,class:"user-table"},null,8,["data","loading"]),h("div",ee,[o(n(Q),{page:e.Page_Number,"onUpdate:page":t[3]||(t[3]=l=>e.Page_Number=l),"page-size":e.Row_Count,"item-count":e["item-count"],"show-size-picker":!1},null,8,["page","page-size","item-count"]),h("div",te,[t[8]||(t[8]=h("span",{class:"text-sm"},"Jump to:",-1)),o(n(W),{value:i.value,"onUpdate:value":t[4]||(t[4]=l=>i.value=l),min:1,max:y.value,"show-button":!1,size:"small",style:{width:"80px"},onKeyup:V(R,["enter"])},null,8,["value","max"]),o(n(w),{size:"small",onClick:R},{default:r(()=>[...t[7]||(t[7]=[b("Go",-1)])]),_:1})])])]),_:1})])}}}),ke=X(ae,[["__scopeId","data-v-11eb48d0"]]);export{ke as default};
