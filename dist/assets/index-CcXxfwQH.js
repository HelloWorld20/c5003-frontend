import{_ as U,N as F}from"./round-add-DLFSrtba.js";import{_ as j,a as V}from"./round-search-tzxKjPJ8.js";import{d as J,r as g,bv as K,a as O,F as q,ab as G,b as L,f as o,w as l,g as n,c7 as k,cc as H,B as _,h as f,b_ as I,e as D,c3 as Q,i as v,be as W,o as X}from"./index-Fa26LLGJ.js";import{f as y,d as Z}from"./department-manage-B2EuzGA4.js";import{_ as ee}from"./FormItem-BZKeQ143.js";import{_ as te,a as w}from"./Grid-B2FtaVgP.js";import{N as A}from"./Input-CaFfWc_O.js";import{_ as ae}from"./DatePicker-rMn-1Kn0.js";import{_ as E}from"./Space-DmpO1c5Z.js";import{_ as oe,a as ne}from"./DataTable-rjo85Lnz.js";import{_ as le}from"./InputNumber-CPlT6_RR.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./Popover-OLpDKtti.js";import"./get-D-rsvxxO.js";import"./Follower-YbKMuAEO.js";import"./use-locale-3ZZNx-H2.js";import"./use-compitable-BSzTa9o4.js";import"./get-slot-Bk_rJcZu.js";import"./use-keyboard-DyVeZvMZ.js";import"./FocusDetector-UVToc5yR.js";import"./Forward-Cjyugl_j.js";import"./Dropdown-CxFzKVN2.js";import"./create-C8zW23Rr.js";import"./Tooltip-DtJC1sbC.js";import"./Select-Bmi32fUm.js";import"./download-C2161hUv.js";const re={class:"user-management"},se={class:"flex items-center gap-4 mt-4"},ie={class:"flex items-center gap-2"},me=J({__name:"index",setup(_e){const C=W(),s=g({Employee_ID:"",Dept_Number:"",Date:null}),p=g([]),t=K({Page_Number:1,Row_Count:10,"item-count":0}),M=g(!1),m=g(1),R=O(()=>{const a=t["item-count"];return a===0?1:Math.ceil(a/t.Row_Count)}),Y=[{title:"Employee ID",key:"emp_no",width:120},{title:"Dept ID",key:"dept_no",width:120},{title:"From Date",key:"from_date",width:140},{title:"To Date",key:"to_date",width:140},{title:"Operation",key:"actions",width:150,fixed:"right",render:a=>v(E,{},{default:()=>[v(_,{size:"small",type:"primary",onClick:()=>$(a)},{default:()=>"Edit"}),v(F,{onPositiveClick:()=>z(a)},{trigger:()=>v(_,{size:"small",type:"error"},{default:()=>"Delete"}),default:()=>"Are you sure to delete this department manager?"})]})}];function $(a){console.log("Edit department manager:",a),C.push({path:"/departments-manager/detail",query:{emp_no:a.emp_no,dept_no:a.dept_no,from_date:a.from_date,to_date:a.to_date}})}async function z(a){try{await Z({emp_no:a.emp_no,dept_no:a.dept_no}),d(),window.$message?.success("Delete successful")}catch(e){console.error("Delete error:",e),window.$message?.error(e?.message||"Delete failed")}}function T(){console.log("搜索条件:",s),t.Page_Number=1,d()}function N(){S(),d()}function B(){console.log("新增用户"),C.push("/departments-manager/detail")}function P(){const a=m.value;if(!a||a<1){window.$message?.warning("Please enter a valid page number"),m.value=t.Page_Number;return}const e=R.value;if(a>e){window.$message?.warning(`Page number cannot exceed ${e}`),m.value=t.Page_Number;return}t.Page_Number=a}function S(){s.value={Employee_ID:"",Dept_Number:"",Date:null}}function d(){let a={...s.value,Page_Number:t.Page_Number||1,Row_Count:t.Row_Count||10};if(a.Date){const[e,u]=a.Date;a.From_Date=e?k(e).format("YYYY-MM-DD"):void 0,a.To_Date=u?k(u).format("YYYY-MM-DD"):void 0,delete a.Date}a=H(a),y(a).then(e=>{Array.isArray(e)?(p.value=e,e.length<t.Row_Count?t["item-count"]=(t.Page_Number-1)*t.Row_Count+e.length:(x(a).then(u=>{u!==null?t["item-count"]=u:t["item-count"]=t.Page_Number*t.Row_Count+1}),t["item-count"]=t.Page_Number*t.Row_Count+1)):e&&e.data&&Array.isArray(e.data)?(p.value=e.data,e.total!==void 0?t["item-count"]=e.total:e.data.length<t.Row_Count?t["item-count"]=(t.Page_Number-1)*t.Row_Count+e.data.length:(x(a).then(u=>{u!==null?t["item-count"]=u:t["item-count"]=t.Page_Number*t.Row_Count+1}),t["item-count"]=t.Page_Number*t.Row_Count+1)):(p.value=[],t["item-count"]=0)}).catch(e=>{console.error("Search error:",e),p.value=[],t["item-count"]=0})}async function x(a){try{const e={...a,Page_Number:10,Row_Count:t.Row_Count},u=await y(e),c=Array.isArray(u)?u:u?.data||[];if(c.length===0){for(let i=9;i>=2;i--){const r={...a,Page_Number:i,Row_Count:t.Row_Count},b=await y(r),h=Array.isArray(b)?b:b?.data||[];if(h.length>0)return h.length<t.Row_Count?(i-1)*t.Row_Count+h.length:i*t.Row_Count+1}return t.Row_Count}else return c.length<t.Row_Count?9*t.Row_Count+c.length:10*t.Row_Count}catch(e){return console.error("Error checking total count:",e),null}}return q(()=>{N(),d()}),G(()=>t.Page_Number,a=>{m.value=a,d()}),(a,e)=>{const u=j,c=V,i=U;return X(),L("div",re,[o(n(I),{title:"Search Conditions",class:"mb-4"},{default:l(()=>[o(n(ee),{model:s.value,"label-placement":"left","label-width":"130px",class:"search-form"},{default:l(()=>[o(n(te),{cols:4,"x-gap":16,"y-gap":16},{default:l(()=>[o(n(w),{label:"Employee ID",span:1},{default:l(()=>[o(n(A),{value:s.value.Employee_ID,"onUpdate:value":e[0]||(e[0]=r=>s.value.Employee_ID=r),clearable:"",placeholder:"Please Input"},null,8,["value"])]),_:1}),o(n(w),{label:"Dept ID",span:1},{default:l(()=>[o(n(A),{value:s.value.Dept_Number,"onUpdate:value":e[1]||(e[1]=r=>s.value.Dept_Number=r),clearable:"",placeholder:"Please Input"},null,8,["value"])]),_:1}),o(n(w),{label:"Date Range",span:1},{default:l(()=>[o(n(ae),{value:s.value.Date,"onUpdate:value":e[2]||(e[2]=r=>s.value.Date=r),type:"daterange",clearable:"",placeholder:"Select Date Range",style:{width:"100%"}},null,8,["value"])]),_:1}),o(n(w),{span:1},{default:l(()=>[o(n(E),null,{default:l(()=>[o(n(_),{type:"primary",onClick:T},{icon:l(()=>[o(u)]),default:l(()=>[e[5]||(e[5]=f(" Search ",-1))]),_:1}),o(n(_),{onClick:N},{icon:l(()=>[o(c)]),default:l(()=>[e[6]||(e[6]=f(" Reset ",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),o(n(I),{title:"Current Department Managers"},{"header-extra":l(()=>[o(n(_),{type:"primary",onClick:B},{icon:l(()=>[o(i)]),default:l(()=>[e[7]||(e[7]=f(" Add Manager ",-1))]),_:1})]),default:l(()=>[o(n(oe),{columns:Y,data:p.value,loading:M.value,bordered:!1,"single-line":!1,class:"user-table"},null,8,["data","loading"]),D("div",se,[o(n(ne),{page:t.Page_Number,"onUpdate:page":e[3]||(e[3]=r=>t.Page_Number=r),"page-size":t.Row_Count,"item-count":t["item-count"],"show-size-picker":!1},null,8,["page","page-size","item-count"]),D("div",ie,[e[9]||(e[9]=D("span",{class:"text-sm"},"Jump to:",-1)),o(n(le),{value:m.value,"onUpdate:value":e[4]||(e[4]=r=>m.value=r),min:1,max:R.value,"show-button":!1,size:"small",style:{width:"80px"},onKeyup:Q(P,["enter"])},null,8,["value","max"]),o(n(_),{size:"small",onClick:P},{default:l(()=>[...e[8]||(e[8]=[f("Go",-1)])]),_:1})])])]),_:1})])}}}),Se=ue(me,[["__scopeId","data-v-317b89f5"]]);export{Se as default};
